MDASH, Release 3.1.0, December 2017.
====================================

Downloading and verifying the release files
-------------------------------------------

The latest release files are provided at
[GitHub](https://github.com/uop-ibbs/mdash/releases/latest) as
source code archives

    mdash-x.y.z.tar.bz2
    mdash-x.y.z.tar.gz
    mdash-x.y.z.zip

and binary packages

    mdash-x.y.z-1.el7.x86_64.rpm (fopr RHEL7/CentOS7/ScientificLinux7)
    mdash_x.y.z-0xenial1_amd64.deb (for Ubuntu16.04)
    mdash-x.y.z.exe (for Windows10)

The file `SHA256SUMS` contains the SHA256 checksums for each file.

The files are signed with the
[GPG public key](https://github.com/uop-ibbs/mdash/master/pubkey.asc)
with fingerprint 0C66 53A8 6507 A92D CD07 B878 BBD9 D1DB 4E10 D89E.
The signatures are in the files with .asc extensions.

To verify a signature, first import the public key:

    gpg --import https://github.com/uop-ibbs/mdash/master/pubkey.asc

then use the command:

    gpg --verify mdash-x.y.z.tar.bz2.asc

replacing the name of the file as appropriate. If all is well this
should produce output along the lines of:

[TODO]
The warning is expected and can be ignored.


Installing binary packages
--------------------------

To install a GNU/Linux binary package use the appropriate command

    sudo rpm -ihv mdash-x.y.z-1.el7.x86_64.rpm
    sudo dpkg -i mdash_x.y.z-0xenial1_amd64.deb

On Windows simply run mdash-x.y.z.exe.

The binary packages install under `/usr` on GNU/Linux and `C:\Program
Files (x86)\mdash-x.y.z on Windows.


Extracting the source code
--------------------------

Use one of the commands

    tar xjf mdash-x.y.z.tar.bz2
    tar xf mdash-x.y.z.tar.gz
    unzip mdash-x.y.z.zip

to unpack the archive into a directory `mdash-x.y.z`.


Building MDASH on Windows
-------------------------

If you wish to use MDASH on Windows you are *strongly* advised to
use the binary installer and avoid building from the source code.

The simplest way to build MDASH on Windows is to use the [MSYS2
environment](https://msys2.github.io/). This is a much-improved
successor to Cygwin and the various versions of MinGW, and is highly
recommended. See the [Distribution-specific notes](#user-content-distribution-specific-notes)
for details on setting up MSYS2 and installing the prerequisites, then
follow the instructions for installing on GNU/Linux.

Alternatively, masochists may build MDASH using the Visual Studio
command-line tools by following the instructions in
[Building on Windows with Visual Studio](#user-content-building-on-windows-with-visual-studio).


Prerequisites
-------------

The following packages are required to build MDASH from source code.
They are provided by the package managers in the major GNU/Linux
distributions.

### [Boost](<http://www.boost.org>)

In addition to the Boost headers, the Boost program-options,
filesystem, system, regex and iostreams libraries are required.

RHEL-7.x: boost-devel, boost-program-options, boost-filesystem,
          boost-system, boost-regex, boost-iostreams

Ubuntu-16.04: libboost-dev, libboost-program-options-dev,
              libboost-filesystem-dev, libboost-system-dev,
              libboost-regex-dev, libboost-iostreams-dev

OpenSUSE-42.3: boost-devel, libboost_program_options,
               libboost_filesystem, libboost_system,
               libboost_regex, libboost_iostreams

MSYS2: mingw-w64-x86_64-boost


The GNU/Linux build includes an interface to read trajectories
generated by [AMBER](http://ambermd.org). This requires version 1.64 of
the Boost libraries, released April 2017. This is not yet available
via the package managers, so must be installed manually following the
instructions on the Boost website. Only the required libraries
(program-options, filesystem, system, regex and iostreams) need to be
compiled. The AMBER interface can be disabled by using the
'--disable-amber' configure option, in which case an earlier version
of the Boost libraries will suffice.


### [Eigen](<http://eigen.tuxfamily.org>)

RHEL-7.x: eigen3-devel

Ubuntu-16.04: libeigen3-dev

OpenSUSE-42.3: eigen3-devel

MSYS2: mingw-w64-x86_64-eigen3


### Compression and image libraries (zlib, bzip2, png)

The zlib, bzip2, and png development packages are required to deal
with compressed input files and to save images from the GUI in PNG
format.

RHEL-7.x: zlib-devel, bzip2-devel, libpng-devel

Ubuntu-16.04: libbz2-dev, zlib1g-dev, libpng12-dev

OpenSUSE-42.3: libbz2-devel

MSYS2: mingw-w64-x86_64-bzip2


### OpenGL (GL, GLU, GLEW, GLM)

OpenGL is required for the display of principal components in the
graphical version of MDASH. It is not required for the command-line
version of MDASH, which is built by using the `--disable-gui`
configure option.

GLEW, the OpenGL Extension Wrangler Library, is available from
<http://glew.sourceforge.net/>.

GLM, the OpenGL Maths Library, is a header-only library available from
<http://glm.g-truc.net>.

RHEL-7.x: mesa-libGL-devel, mesa-libGLU-devel, glew-devel, glm-devel

Ubuntu-16.04: libgl1-mesa-dev, libglu1-mesa-dev, libglew-dev, libglm-dev

OpenSUSE-42.3: Mesa-libGL-devel, glu-devel, glew-devel, glm-devel

MSYS2: mingw-w64-x86_64-glew, mingw-w64-x86_64-glm


### [wxWidgets](<http://www.wxwidgets.org>)

The wxWidgets toolkit is required for the graphical version of
MDASH. It is not required for the command-line version of MDASH, which
is built by using the `--disable-gui` configure option.

RHEL-7.x: wxGTK3, wxGTK3-devel, wxGTK3-gl
  (from the EPEL repository, http://fedoraproject.org/wiki/EPEL - see Distribution-specific notes)

Ubuntu-16.04: wx-common, wx3.0-headers, libwxbase3.0-0, libwxbase3.0-dev, libwxgtk3.0-0, libwxgtk3.0-dev

OpenSUSE-42.3: wxGTK3-3_0-devel

MSYS2: mingw-w64-x86_64-wxWidgets

If wxWidgets is built from source, ensure that OpenGL support is
included (use the `--with-opengl` option when configuring wxWidgets).


### [wxFreeChart](<http://wxcode.sourceforge.net/components/freechart/>)

A (mildly) modified version of wxFreeChart is provided in the
`mdash-x.y.z/src/wxfreechart` directory. This code is distributed
under the wxWindows Library Licence, Version 3.1 (GPLv2+ with
an exception allowing static linking).


Building MDASH on GNU/Linux
---------------------------

Follow the usual incantation:

    cd mdash-x.y.z
    mkdir build
    cd build
    ../configure
    make
    make check
    make install

The configure step may fail if the prerequisites are not installed in
standard locations. In that case, use the command

    ../configure --help

to list the options available, and re-run configure with the
appropriate paths specified.

The default build creates a program with a graphical interface. To
build a command-line only version, not requiring any graphics
libraries, use:

    ../configure --disable-gui

The GNU/Linux build includes an interface to read trajectories
generated by AMBER (http://ambermd.org). This requires the AmberTools
`cpptraj` program to be present on the PATH. To disable this feature,
use:

    ../configure --disable-amber


`make` builds the executable `mdash-x.y.z/build/src/dash/mdash`. The
Perl script `amberdash` is provided in `mdash-x.y.z/src/dash`. These
can be run in-place or moved to somewhere more convenient. The files
`mdash.pdf`, `mdash.html` and `mdash.info` in the directory
`mdash-x.y.z/src/mdash` contain documentation in the indicated
formats.

`make check` runs some rudimentary test cases.

`make install` is optional. It copies the programs `mdash` and
`amberdash` to `PREFIX/bin`, the pdf and html manuals to
`PREFIX/share/doc/mdash-x.y.z`, and installs the 'info' manual in
`PREFIX/share/info`. This requires write access to the `PREFIX`
directory (specified by the `--prefix` configure option; default
`/usr/local`).

`make uninstall` is also provided.


Building with CMake
-------------------

Support is provided for cmake builds, though this is less well
tested. Follow the standard procedure:

    cd mdash-x.y.z
    mkdir build
    cd build
    cmake ..
    make
    make check
    make install

Aspects of the build are controlled by the following variables
(specified with -D on the cmake command line):

    BUILD_GUI[=ON]
    BUILD_AMBER[=ON]
    BOOST_ROOT        boost installation directory
    EIGEN3_INCLUDE    directory containing Eigen/Core

For example:

    cmake -DBUILD_GUI=OFF -DBOOST_ROOT=/opt/modules/boost/1.64.0 ..


Building on Windows with Visual Studio
--------------------------------------

This should only be considered by experienced developers, it is
definitely not for the faint-hearted. The main obstacle is in setting
up the prerequisites. Although there are relatively few of these, it
is extremely easy to end up with incompatible versions of the Boost
and wxWidgets libraries, so follow these instructions closely. The
strategy is to use a pre-compiled version of the Boost libraries and
build the wxWidgets libraries from source code to match. Start by
creating a folder to contain all the prerequisites, referred to below
as MDASHREQ.

### Boost

From the [Boost home page](www.boost.org) select `More Downloads` then
follow the `Windows Binaries` link. From `DEPENDENCY_VERSIONS.txt`
match your version of Visual Studio to an msvc version. Then download
the 32-bit version of the corresponding Boost libraries. For Visual
Studio 2017, for example, use `Boost_1_65_1_msvc_14.1-32.exe`. Run the
.exe and install the libraries in MDASHREQ.

### wxWidgets

Download the source code for the latest development release (3.1.0)
from the wxWidgets [downloads](https://wxwidgets.org/downloads/)
page. Choose the .zip or .7z archive and uncompress it in MDASHREQ.

Open the Visual Studio x86 Native Tools Command Prompt and run these commands:

    cd MDASHREQ\wxWidgets-3.1.0\build\msw
    nmake /f makefile.vc BUILD=release

### Eigen

From the [Eigen home page](<http://eigen.tuxfamily.org>) download the
.zip file for the latest stable release (3.3.4) and unpack it in
MDASHREQ.

### GLEW

From the [GLEW home page](http://glew.sourceforge.net) follow the link
to `Binaries: Windows 32-bit and 64-bit` to download the latest
version (glew-2.1.0-win32.zip). Unpack the .zip file in MDASHREQ.

### GLM

From the [GLM home page](https://glm.g-truc.net) select `Downloads`
from the left-hand menu and download the .zip file for the latest
stable release (glm-0.9.8.5.zip). Unpack the .zip file in MDASHREQ.


The result should be a folder containing these subfolders (version
numbers may vary):

[TODO: check]
    wxWidgets-3.1.0
    boost-1.65.1
    Eigen-3.3.4
    glew-2.1.0
    glm-0.9.8.5


### CMake

Download and install the latest stable version of CMake from
https://cmake.org/download/.


With the prerequisites in place, the actual build is straightforward.

	1. Download and unpack the source code distribution
       mdash-x.y.z.zip.

	2. Edit the file `cmake.bat` in the `mdash-x.y.z` directory so
       that the paths match your installation of the prerequisites.
       Optionally, insert a line

           -DCMAKE_INSTALL_PREFIX=c:\<prefix>^

       to install MDASH somewhere other than the default location,
       C:\Program Files (x86), which requires administrator
       privileges.

	3. Open the Visual Studio x86 Native Tools Command Prompt.

	4. In the command window, change to the `mdash-x.y.z` directory
       and run the following commands:

           mkdir build
           cd build
           ..\cmake.bat
           nmake
           nmake install

       The final install step is optional. The mdash.exe program is built in [TODO]???? and may be moved to somewhere more convenient.


Distribution-specific notes
---------------------------

### RHEL-7.x

The `wx-config` script provided in the EPEL wxWidgets 3.0.x packages
is actually called `wx-config-3.0`. This has to be specified in the
configure command, *i.e.* use

    ../configure --with-wx-config=/usr/bin/wx-config-3.0


### Ubuntu-14.04

A bug in the version of Eigen (3.2.0) distributed with Ubuntu 14.04
causes the PCA calculation to fail with an unhandled exception.
Therefore a later version of Eigen must be used. As Eigen is a
header-only affair, this is easy. Simply download the latest version
of Eigen from eigen.tuxfamily.org, unpack it, and use the configure
option

    ../configure --with-eigen-include=path-to-eigen

where `path-to-eigen` is the parent of the directory named `Eigen`.


### MSYS2

Follow the instructions at https://msys2.github.io/ to install and
update MSYS2. Then use the following command in the MSYS2 shell to
install the build tools and prerequisites:

    pacman -S make tar pkg-config diffutils \
              mingw-w64-x86_64-gcc \
              mingw-w64-x86_64-boost \
              mingw-w64-x86_64-eigen3 \
              mingw-w64-x86_64-wxWidgets \
              mingw-w64-x86_64-glew \
              mingw-w64-x86_64-glm

In MSYS2 version 20160921 a bug causes the pacman command to fail with
an error "/mingw64 exists in filesystem", although the directory
/mingw64 doesn't in fact exist. The workaround is to create the
directory /mingw64 manually:

    mkdir /mingw64

then re-run the pacman command.

To build MDASH, open an MSYS2 MinGW64 shell and follow the
instructions above for installing on GNU/Linux, specifying the
location of the boost libraries and disabling the AMBER interface in
the configuration step:

    ../configure --prefix=/usr/local --with-boost=/mingw64 --disable-amber

The --prefix option is included here because the default installation
prefix on MSYS2 is /mingw64.

The version of GCC provided with MSYS2 is rather recent and produces
copious warnings, mainly about deprecated features in the Eigen and
Boost libraries. These can be ignored. To reduce the noise, use

    CXXFLAGS="-Wno-deprecated-declarations -Wno-ignored-attributes" ../configure <configure-options>

in the configuration step.

The resulting mdash executable is a native Windows program, which can
be run from the MSYS2 MinGW64 shell. It can also be run directly from
Windows, via 'Run' or a Command Window, provided c:\msys64\mingw64\bin
and c:\msys64\usr\local\bin are added to the PATH environment
variable.


Amberdash
---------

The Perl script `amberdash` runs MDASH on trajectories generated by
[Amber](http://ambermd.org). Documentation in POD format is included
in the file. To read it use the command

    perldoc amberdash

The script calls `mdash` and `cpptraj`. If they are not on the PATH,
specify their full pathnames at the top of the script.
